
FROM debian:bookworm-slim AS prod
WORKDIR /

ENV TINI_VERSION v0.19.0
ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static /tini
RUN chmod +x /tini

ARG EXEC_ENV
ENV EXEC_ENV=$EXEC_ENV
ARG DATABASE_URL
ENV DATABASE_URL=$DATABASE_URL
ARG DB_NAME
ENV DB_NAME=$DB_NAME
ARG APP_API_HOST
ENV APP_API_HOST=$APP_API_HOST
ARG APP_API_PORT
ENV APP_API_PORT=$APP_API_PORT
ARG APP_API_CORS
ENV APP_API_CORS=$APP_API_CORS
ARG APP_AUTH_SECRET
ENV APP_AUTH_SECRET=$APP_AUTH_SECRET
ARG CONFIRM_SHARED_SECRET
ENV CONFIRM_SHARED_SECRET=$CONFIRM_SHARED_SECRET
ARG S3_URL
ENV S3_URL=$S3_URL
ARG S3_ACCESS_KEY_ID
ENV S3_ACCESS_KEY_ID=$S3_ACCESS_KEY_ID
ARG S3_SECRET_ACCESS_KEY
ENV S3_SECRET_ACCESS_KEY=$S3_SECRET_ACCESS_KEY
ARG SENDGRID_API_KEY
ENV SENDGRID_API_KEY=$SENDGRID_API_KEY

COPY --chmod=755 ./backend/target/release/quizzo-api /
ENTRYPOINT ["/tini", "--"]
CMD ["/quizzo-api"]
